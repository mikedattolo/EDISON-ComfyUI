<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDISON - Offline AI Assistant</title>
    <link rel="stylesheet" href="styles.css?v=8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="theme-device.js?v=3"></script>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Backdrop -->
        <div class="mobile-backdrop" id="mobileBackdrop"></div>
        
        <!-- Mobile Header (hidden on desktop) -->
        <div class="mobile-header" id="mobileHeader" style="display: none;">
            <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
            <h1>EDISON</h1>
        </div>
        <!-- Hardware Monitor Widget -->
        <div class="hardware-monitor" id="hardwareMonitor" style="display: none;">
            <div class="hw-header">
                <span class="hw-title">System Monitor</span>
                <button class="hw-close" id="hwCloseBtn">√ó</button>
            </div>
            <div class="hw-stats">
                <div class="hw-stat">
                    <span class="hw-label">CPU</span>
                    <div class="hw-bar"><div class="hw-fill" id="cpuBar"></div></div>
                    <span class="hw-value" id="cpuValue">0%</span>
                </div>
                <div class="hw-stat">
                    <span class="hw-label">GPU</span>
                    <div class="hw-bar"><div class="hw-fill" id="gpuBar"></div></div>
                    <span class="hw-value" id="gpuValue">0%</span>
                </div>
                <div class="hw-stat">
                    <span class="hw-label">RAM</span>
                    <div class="hw-bar"><div class="hw-fill" id="ramBar"></div></div>
                    <span class="hw-value" id="ramValue">0GB</span>
                </div>
                <div class="hw-stat">
                    <span class="hw-label">Temp</span>
                    <span class="hw-temp" id="tempValue">--¬∞C</span>
                </div>
            </div>
        </div>

        <!-- Work Mode Desktop View -->
        <div class="work-desktop" id="workDesktop" style="display: none;">
            <div class="work-header">
                <h2>üñ•Ô∏è AI Desktop - Task Workspace</h2>
                <button class="work-close" id="workCloseBtn">√ó</button>
            </div>
            <div class="work-content">
                <div class="work-panel">
                    <h3>üìã Current Task</h3>
                    <div id="currentTask" class="task-display">Waiting for task...</div>
                </div>
                <div class="work-panel">
                    <h3>üîç Search Results</h3>
                    <div id="searchResults" class="results-display"></div>
                </div>
                <div class="work-panel">
                    <h3>üìÑ Documents</h3>
                    <div id="workDocuments" class="docs-display"></div>
                </div>
                <div class="work-panel full-width">
                    <h3>üí≠ Thinking Process</h3>
                    <div id="thinkingLog" class="log-display"></div>
                </div>
            </div>
        </div>

        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
        </button>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect width="32" height="32" rx="8" fill="url(#gradient)"/>
                        <path d="M10 12h12M10 16h12M10 20h8" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#667eea"/>
                                <stop offset="100%" stop-color="#764ba2"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <h1>EDISON</h1>
                </div>
                <button class="new-chat-btn" id="newChatBtn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    New Chat
                </button>
                
                <!-- Gallery Button -->
                <button class="gallery-btn" id="galleryBtn" title="View generated images">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <rect x="2" y="3" width="16" height="11" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <circle cx="7" cy="7" r="1.5" fill="currentColor"/>
                        <path d="M2 13l4-4 3 3 4-5 5 6" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    </svg>
                    Gallery
                </button>
            </div>
            
            <!-- Search bar for chat history -->
            <div class="chat-search">
                <input type="text" id="chatSearchInput" placeholder="Search conversations..." />
                <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <circle cx="6.5" cy="6.5" r="5" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <path d="M10 10l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            
            <div class="chat-history" id="chatHistory">
                <!-- Chat history items will be inserted here -->
            </div>
            
            <div class="sidebar-footer">
                <button class="settings-btn" id="settingsBtn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3a7 7 0 100 14 7 7 0 000-14zm0 2a5 5 0 110 10 5 5 0 010-10z"/>
                    </svg>
                    Settings
                </button>
                <button class="monitor-btn" id="monitorBtn" title="Toggle system monitor" onclick="event.stopPropagation(); window.toggleHardwareMonitor && window.toggleHardwareMonitor(event);">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <rect x="2" y="3" width="16" height="11" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <path d="M7 17h6M10 14v3" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="chat-container">
                <div class="messages-container" id="messagesContainer">
                    <div class="welcome-screen" id="welcomeScreen">
                        <h2>Welcome to EDISON</h2>
                        <p>Your offline AI assistant for conversations, code, and creative tasks</p>
                        
                        <div class="capabilities">
                            <div class="capability-card">
                                <div class="capability-icon">üí¨</div>
                                <h3>Natural Conversations</h3>
                                <p>Chat naturally with fast responses using the 14B model</p>
                            </div>
                            <div class="capability-card">
                                <div class="capability-icon">üß†</div>
                                <h3>Deep Thinking</h3>
                                <p>Get detailed analysis with the powerful 72B model</p>
                            </div>
                            <div class="capability-card">
                                <div class="capability-icon">üíª</div>
                                <h3>Code Assistant</h3>
                                <p>Write, debug, and explain code in multiple languages</p>
                            </div>
                            <div class="capability-card">
                                <div class="capability-icon">ü§ñ</div>
                                <h3>Agent Mode</h3>
                                <p>Execute complex tasks with tool-using capabilities</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-container">
                    <div class="input-wrapper">
                        <div class="mode-selector">
                            <button class="mode-btn active" data-mode="auto" title="Auto-detect intent">
                                <span class="mode-icon">üîÆ</span>
                                <span class="mode-label">Auto</span>
                            </button>
                            <button class="mode-btn" data-mode="chat" title="Fast responses (14B)">
                                <span class="mode-icon">üí¨</span>
                                <span class="mode-label">Chat</span>
                            </button>
                            <button class="mode-btn" data-mode="reasoning" title="Detailed analysis (72B)">
                                <span class="mode-icon">üß†</span>
                                <span class="mode-label">Deep</span>
                            </button>
                            <button class="mode-btn" data-mode="code" title="Code assistance">
                                <span class="mode-icon">üíª</span>
                                <span class="mode-label">Code</span>
                            </button>
                            <button class="mode-btn" data-mode="agent" title="Tool-using agent">
                                <span class="mode-icon">ü§ñ</span>
                                <span class="mode-label">Agent</span>
                            </button>
                            <button class="mode-btn" data-mode="work" title="Work mode with task visualization">
                                <span class="mode-icon">üñ•Ô∏è</span>
                                <span class="mode-label">Work</span>
                            </button>
                        </div>
                        
                        <div class="input-area">
                            <input type="file" id="fileInput" multiple style="display: none;" accept="*/*" />
                            <button class="attach-btn" id="attachBtn" title="Upload files (text, code, images)" onclick="event.stopPropagation(); window.triggerFileUpload && window.triggerFileUpload(event);">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 3v14M3 10h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <textarea 
                                id="messageInput" 
                                placeholder="Message EDISON..." 
                                rows="1"
                                maxlength="4000"
                            ></textarea>
                            <button class="send-btn" id="sendBtn" disabled>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M2 10l16-8-8 16-2-8-6-0z"/>
                                </svg>
                            </button>
                            <button class="stop-btn" id="stopBtn" style="display: none;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <rect x="5" y="5" width="10" height="10" rx="1"/>
                                </svg>
                            </button>
                        </div>
                        <div class="attached-files" id="attachedFiles" style="display: none;">
                            <!-- Attached files will appear here -->
                        </div>
                        
                        <div class="input-footer">
                            <div class="auto-memory-indicator" title="EDISON automatically remembers important conversations">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.6;">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                                </svg>
                                <span style="opacity: 0.6; font-size: 12px;">Auto memory enabled</span>
                            </div>
                            <span class="char-count" id="charCount">0 / 4000</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn" id="closeSettingsBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="apiEndpoint">API Endpoint</label>
                        <input type="text" id="apiEndpoint" value="http://192.168.1.26:8811" placeholder="http://localhost:8811">
                        <p class="setting-description">The URL of your EDISON Core service</p>
                    </div>
                    
                    <div class="setting-group">
                        <label for="comfyuiEndpoint">ComfyUI Endpoint</label>
                        <input type="text" id="comfyuiEndpoint" value="http://192.168.1.26:8188" placeholder="http://localhost:8188">
                        <p class="setting-description">The URL of your ComfyUI service (for image generation)</p>
                    </div>
                    
                    <div class="setting-group">
                        <label>Theme</label>
                        <div class="theme-toggle">
                            <button class="theme-btn active" data-theme="dark" id="darkThemeBtn">üåô Dark</button>
                            <button class="theme-btn" data-theme="light" id="lightThemeBtn">‚òÄÔ∏è Light</button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Color Scheme</label>
                        <div class="color-palette">
                            <button class="color-btn default active" data-color="default" title="Default (Indigo)"></button>
                            <button class="color-btn blue" data-color="blue" title="Blue"></button>
                            <button class="color-btn purple" data-color="purple" title="Purple"></button>
                            <button class="color-btn cyan" data-color="cyan" title="Cyan"></button>
                            <button class="color-btn emerald" data-color="emerald" title="Emerald"></button>
                            <button class="color-btn rose" data-color="rose" title="Rose"></button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="defaultMode">Default Mode</label>
                        <select id="defaultMode">
                            <option value="auto">Auto (Intent Detection)</option>
                            <option value="chat">Chat (14B Fast)</option>
                            <option value="reasoning">Deep (72B Detailed)</option>
                            <option value="code">Code Assistant</option>
                            <option value="agent">Agent Mode</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="streamResponses" checked>
                            Stream responses (when available)
                        </label>
                    </div>
                    
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="syntaxHighlight" checked>
                            Enable syntax highlighting for code
                        </label>
                    </div>
                    
                    <div class="setting-group">
                        <h3>System Status</h3>
                        <div class="status-indicator" id="systemStatus">
                            <span class="status-dot"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" id="clearHistoryBtn">Clear Chat History</button>
                    <button class="btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Gallery Panel -->
        <div class="gallery-panel" id="galleryPanel">
            <div class="gallery-header">
                <h2>üñºÔ∏è Image Gallery</h2>
                <button class="gallery-close-btn" id="galleryCloseBtn">√ó</button>
            </div>
            <div class="gallery-content" id="galleryContent">
                <div class="gallery-loading" id="galleryLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading images...</p>
                </div>
                <div class="gallery-empty" id="galleryEmpty" style="display: none;">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="currentColor" style="opacity: 0.3;">
                        <rect x="8" y="12" width="48" height="36" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="20" cy="24" r="4" fill="currentColor"/>
                        <path d="M8 44l12-12 8 8 12-16 16 20" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <h3>No images yet</h3>
                    <p>Generated images will appear here</p>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Images will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="settings-close-btn" id="settingCloseBtn">√ó</button>
            </div>
            <div class="settings-content">
                <!-- Theme Selection -->
                <div class="settings-group">
                    <label class="settings-group-label">Theme</label>
                    <div class="theme-toggle">
                        <button class="theme-btn active" data-theme="dark" id="darkThemeBtn">üåô Dark</button>
                        <button class="theme-btn" data-theme="light" id="lightThemeBtn">‚òÄÔ∏è Light</button>
                    </div>
                </div>

                <!-- Color Selection -->
                <div class="settings-group">
                    <label class="settings-group-label">Color Scheme</label>
                    <div class="color-palette">
                        <button class="color-btn default active" data-color="default" title="Default (Indigo)"></button>
                        <button class="color-btn blue" data-color="blue" title="Blue"></button>
                        <button class="color-btn purple" data-color="purple" title="Purple"></button>
                        <button class="color-btn cyan" data-color="cyan" title="Cyan"></button>
                        <button class="color-btn emerald" data-color="emerald" title="Emerald"></button>
                        <button class="color-btn rose" data-color="rose" title="Rose"></button>
                    </div>
                </div>

                <!-- Device Info -->
                <div class="settings-group">
                    <label class="settings-group-label">Device Info</label>
                    <div style="padding: 12px; background: var(--surface-hover); border-radius: 8px; font-size: 13px; color: var(--text-secondary);">
                        <div style="margin-bottom: 6px;"><strong>Type:</strong> <span id="deviceType">Loading...</span></div>
                        <div style="margin-bottom: 6px;"><strong>Screen:</strong> <span id="screenSize">Loading...</span></div>
                        <div style="margin-bottom: 6px;"><strong>Orientation:</strong> <span id="deviceOrientation">Loading...</span></div>
                        <div><strong>API:</strong> <span id="apiEndpoint">Loading...</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global function to download images
        function downloadImage(url, filename) {
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const blobUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = blobUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(blobUrl);
                })
                .catch(error => console.error('Download failed:', error));
        }

        // Global function to regenerate images
        function regenerateImage(prompt) {
            // Access the app instance and trigger regeneration
            if (window.edisonApp) {
                // Set the message input to the prompt
                window.edisonApp.messageInput.value = `generate an image of ${prompt}`;
                // Trigger send
                window.edisonApp.sendMessage();
            }
        }
    </script>

    <script src="gallery.js?v=2"></script>
    <script src="app_enhanced.js?v=10"></script>
    <script src="app_features.js?v=7"></script>
</body>
</html>
